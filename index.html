<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buscador Hoho3D - Filamentos 3D</title>
  <style>
    /* Reset & Base */
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #E0F2F1;
      color: #0A3E36;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    a { color: inherit; text-decoration: none; }
    /* Layout */
    #app {
      display: flex;
      flex:1;
      padding:20px;
      gap:20px;
    }
    section { background: white; border-radius:8px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    /* Stock Izquierda */
    #stock {
      flex:0 0 280px;
      display:flex; flex-direction:column;
    }
    #stock h2 { margin-bottom:12px; color:#00796B; }
    #search { margin-bottom:12px; }
    #search input {
      width:100%;
      padding:8px;
      font-size:1rem;
      border:1px solid #B2DFDB;
      border-radius:4px;
      outline:none;
    }
    #stock-list {
      flex:1;
      overflow-y:auto;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .stock-item {
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px;
      border:1px solid #B2DFDB;
      border-radius:4px;
      transition:background .2s;
    }
    .stock-item:hover {
      background:#B2DFDB;
    }
    .swatch {
      width:24px; height:24px;
      border:1px solid #004D40;
      border-radius:4px;
      flex-shrink:0;
    }
    .info { flex:1; display:flex; flex-direction:column; }
    .info .name { font-weight:600; }
    .info .hex { font-family:monospace; color:#004D40; font-size:.9rem; }
    .info .link { font-size:.8rem; color:#00796B; margin-top:4px; }
    /* Centro: Rueda + preview + cubo + sugerencias */
    #center {
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:16px;
      overflow:hidden;
    }
    #center h2 { color:#00796B; }
    /* Rueda de color */
    #wheel-container { position:relative; }
    canvas#wheel {
      width:280px; height:280px;
      border-radius:50%;
      box-shadow:0 0 10px rgba(0,77,64,0.4);
      cursor:crosshair;
    }
    /* Preview y cubo */
    #selected {
      display:flex; align-items:center; gap:12px;
      font-size:1.1rem;
    }
    #preview {
      width:48px; height:48px;
      border:2px solid #004D40;
      border-radius:4px;
    }
    #cube {
      width:120px; height:120px;
      transform-style:preserve-3d;
      animation:spin 8s linear infinite;
      margin-top:8px;
    }
    #cube div {
      position:absolute;
      width:120px; height:120px;
      border:2px solid #004D40;
      background:inherit;
    }
    #cube .front  { transform:translateZ(60px); }
    #cube .back   { transform:rotateY(180deg) translateZ(60px); }
    #cube .right  { transform:rotateY(90deg) translateZ(60px); }
    #cube .left   { transform:rotateY(-90deg) translateZ(60px); }
    #cube .top    { transform:rotateX(90deg) translateZ(60px); }
    #cube .bottom { transform:rotateX(-90deg) translateZ(60px); }
    @keyframes spin { to { transform:rotateX(360deg) rotateY(360deg); } }
    /* Sugerencias */
    #suggest {
      text-align:center;
      margin-top:16px;
    }
    #suggest button {
      padding:8px 16px;
      background:#00796B;
      color:white;
      border:none;
      border-radius:4px;
    }
    #suggest-text {
      margin-top:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      font-style:italic;
      color:#004D40;
    }
    /* Derecha: Cercanos */
    #nearest {
      flex:0 0 280px;
      display:flex;
      flex-direction:column;
      gap:8px;
      overflow-y:auto;
    }
    #nearest h2 { color:#00796B; }
    .near-item {
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px;
      border:1px solid #B2DFDB;
      border-radius:4px;
      transition:background .2s;
    }
    .near-item:hover { background:#B2DFDB; }
    /* Scrollbar */
    #stock-list::-webkit-scrollbar,
    #nearest::-webkit-scrollbar {
      width:6px;
    }
    #stock-list::-webkit-scrollbar-thumb,
    #nearest::-webkit-scrollbar-thumb {
      background:#004D40;
      border-radius:3px;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Izquierda: Stock -->
    <section id="stock">
      <h2>Filamentos de nuestra web (consultar stock)</h2>
      <div id="search"><input type="text" placeholder="Buscar..." id="search-input"/></div>
      <div id="stock-list"></div>
    </section>

    <!-- Centro -->
    <section id="center">
      <h2>Selector de Color</h2>
      <div id="wheel-container">
        <canvas id="wheel" width="280" height="280"></canvas>
      </div>
      <div id="selected">
        <div id="preview"></div>
        <div id="selected-hex">#000000</div>
      </div>
      <div id="cube">
        <div class="front"></div>
        <div class="back"></div>
        <div class="right"></div>
        <div class="left"></div>
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
      <div id="suggest">
        <button id="suggest-btn">Generar idea 3D</button>
        <div id="suggest-text"></div>
      </div>
    </section>

    <!-- Derecha -->
    <section id="nearest">
      <h2>5 Filamentos más Cercanos</h2>
    </section>
  </div>

<script>
  // Datos stock
  const stock = [
    {name:"Grilon 3 PLA SILK Platino 1.75mm x 1kg",hex:"#5b6770",link:"https://www.hoho3d.com.ar/...5b6770"},
    {name:"Grilon 3 PLA Piel 720 1.75mm x 1kg",hex:"#e7b78a",link:"https://www.hoho3d.com.ar/...e7b78a"},
    {name:"Grilon 3 PLA Gris Plata 1.75mm x 1kg",hex:"#75787b",link:"https://www.hoho3d.com.ar/...75787b"},
    {name:"Grilon 3 PLA Cobre 1.75mm x 1kg",hex:"#a1561c",link:"https://www.hoho3d.com.ar/...a1561c"},
    {name:"Grilon 3 PLA Bronce 1.75mm x 1kg",hex:"#998542",link:"https://www.hoho3d.com.ar/...998542"}
  ];
  const ideas = [
    "Soporte para celular ergonómico",
    "Maceta geométrica para escritorio",
    "Llaveros personalizados",
    "Mini figura decorativa",
    "Porta auriculares flexible"
  ];

  // Referencias DOM
  const listEl = document.getElementById('stock-list');
  const searchEl = document.getElementById('search-input');
  const wheel = document.getElementById('wheel');
  const ctx = wheel.getContext('2d');
  const preview = document.getElementById('preview');
  const selHexEl = document.getElementById('selected-hex');
  const cube = document.getElementById('cube');
  const suggestBtn = document.getElementById('suggest-btn');
  const suggestText = document.getElementById('suggest-text');
  const nearestEl = document.getElementById('nearest');

  let selectedHex = "#5de1df";

  // Mostrar stock
  function renderStock(arr) {
    listEl.innerHTML = '';
    arr.forEach(f => {
      const a = document.createElement('a');
      a.className = 'stock-item';
      a.href = f.link; a.target="_blank";
      a.innerHTML = `<div class="swatch" style="background:${f.hex}"></div>
                     <div class="info">
                      <div class="name">${f.name}</div>
                      <div class="hex">${f.hex}</div>
                      <div class="link">${f.link}</div>
                     </div>`;
      listEl.appendChild(a);
    });
  }
  searchEl.addEventListener('input',()=>{
    const q=searchEl.value.toLowerCase();
    renderStock(stock.filter(f=>f.name.toLowerCase().includes(q)||f.hex.includes(q)));
  });

  // Rueda color continua
  const R=wheel.width/2;
  function drawWheel(){
    const img=ctx.createImageData(280,280), d=img.data;
    for(let y=0;y<280;y++){
      for(let x=0;x<280;x++){
        const dx=x-R, dy=y-R, dist=Math.hypot(dx,dy);
        const idx=(y*280+x)*4;
        if(dist>R){ d[idx+3]=0; continue; }
        let ang=Math.atan2(dy,dx); if(ang<0) ang+=2*Math.PI;
        const h=ang*180/Math.PI, s=dist/R, v=1;
        const [r,g,b]=hsvToRgb(h,s,v);
        d[idx]=r; d[idx+1]=g; d[idx+2]=b; d[idx+3]=255;
      }
    }
    ctx.putImageData(img,0,0);
  }
  function hsvToRgb(h,s,v){
    h/=60; const c=v*s, x=c*(1-Math.abs(h%2-1)), m=v-c;
    let [r1,g1,b1]=[0,0,0];
    if(h<1) [r1,g1]=[c,x];
    else if(h<2) [r1,g1]=[x,c];
    else if(h<3) [g1,b1]=[c,x];
    else if(h<4) [g1,b1]=[x,c];
    else if(h<5) [r1,b1]=[x,c];
    else [r1,b1]=[c,x];
    return [Math.round((r1+m)*255),Math.round((g1+m)*255),Math.round((b1+m)*255)];
  }
  function rgbToHex(r,g,b){
    return "#"+[r,g,b].map(n=>n.toString(16).padStart(2,'0')).join('');
  }
  wheel.addEventListener('click',e=>{
    const rect=wheel.getBoundingClientRect();
    const x=e.clientX-rect.left, y=e.clientY-rect.top;
    const dx=x-R, dy=y-R, dist=Math.hypot(dx,dy);
    if(dist>R) return;
    let ang=Math.atan2(dy,dx); if(ang<0) ang+=2*Math.PI;
    const h=ang*180/Math.PI, s=dist/R, v=1;
    const hex=rgbToHex(...hsvToRgb(h,s,v));
    selectColor(hex);
  });

  // Actualizar color
  function selectColor(hex){
    selectedHex=hex;
    preview.style.background=hex;
    selHexEl.textContent=hex;
    updateCube(hex);
    renderNearest();
  }
  // Cubo tintado
  function updateCube(color){
    cube.style.background=color;
    Array.from(cube.children).forEach(face=>face.style.background=color);
  }
  // Colores cercanos
  function renderNearest(){
    nearestEl.innerHTML='<h2>5 Cercanos</h2>';
    const target=hexToRgbArr(selectedHex);
    const sorted=stock.slice().sort((a,b)=>{
      return colorDist(hexToRgbArr(a.hex),target)-colorDist(hexToRgbArr(b.hex),target);
    }).slice(0,5);
    sorted.forEach(f=>{
      const div=document.createElement('a');
      div.className='near-item';
      div.href=f.link; div.target='_blank';
      div.innerHTML=`<div class="closest-color-box" style="background:${f.hex}"></div>
                     <div>${f.name}<br><small>${f.hex}</small></div>`;
      nearestEl.appendChild(div);
    });
  }
  function hexToRgbArr(hex){
    const r=parseInt(hex.slice(1,3),16),
          g=parseInt(hex.slice(3,5),16),
          b=parseInt(hex.slice(5,7),16);
    return [r,g,b];
  }
  function colorDist(a,b){
    return Math.hypot(a[0]-b[0],a[1]-b[1],a[2]-b[2]);
  }
  // Sugerencias
  suggestBtn.addEventListener('click',()=>{
    const idea=ideas[Math.floor(Math.random()*ideas.length)];
    suggestionText.innerHTML=`${idea} <span class="suggestion-color-box" style="background:${selectedHex}"></span>${selectedHex}`;
  });

  // Init
  drawWheel();
  renderStock(stock);
  selectColor("#5de1df");
</script>
</body>
</html>
