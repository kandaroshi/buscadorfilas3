<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Hoho3D – Buscador Profesional</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- -------------------------------------------------------------
       CSS: Variables, Reset, Layout y Componentes
  -------------------------------------------------------------- -->
  <style>
    /* Reset básico */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
    }

    /* Variables de color */
    :root {
      --bg-dark:      #0a1e28;
      --panel-dark:   #12314a;
      --accent:       #3fb7a4;
      --accent-light: #86d0fb;
      --text-light:   #cde9f8;
      --bg-input:     #0e3d53;
      --shadow-dark:  rgba(0,0,0,0.5);
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    /* Cabecera */
    header {
      width: 100%;
      background: var(--panel-dark);
      box-shadow: 0 2px 8px var(--shadow-dark);
      padding: 1rem;
      text-align: center;
    }
    header h1 {
      color: var(--accent);
      font-size: 2rem;
    }
    header p {
      color: var(--accent-light);
      margin-top: 0.5rem;
    }

    /* Layout principal */
    main {
      flex: 1;
      width: 90%;
      max-width: 1200px;
      margin: 1rem 0;
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: 1rem;
    }
    /* Paneles */
    .panel {
      background: var(--panel-dark);
      border-radius: 8px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      box-shadow: inset 0 0 12px rgba(63,183,164,0.5);
    }
    .panel h2 {
      color: var(--accent);
      margin-bottom: 0.75rem;
      font-size: 1.1rem;
    }

    /* -------------------------------------------------------------
       Panel Izquierdo: Buscador de Filamentos
    -------------------------------------------------------------- */
    #searchInput {
      padding: 0.5rem;
      border: none;
      border-radius: 6px;
      background: var(--bg-input);
      color: var(--text-light);
      margin-bottom: 1rem;
    }
    #colorList, #closestList {
      flex: 1;
      overflow-y: auto;
    }
    .color-item, .closest-item {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
      margin-bottom: 0.5rem;
    }
    .color-item:hover, .closest-item:hover {
      background: rgba(63,183,164,0.2);
    }
    .color-box, .closest-box {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      margin-right: 0.75rem;
      border: 2px solid var(--accent);
      flex-shrink: 0;
    }
    .color-info, .closest-info {
      font-size: 0.9rem;
      line-height: 1.2;
    }

    /* -------------------------------------------------------------
       Panel Central: Selector de Color y Vista 3D
    -------------------------------------------------------------- */
    #pickerPanel {
      align-items: center;
      text-align: center;
    }
    #colorWheel {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 12px rgba(63,183,164,0.5);
    }
    #selectedPreview {
      width: 100px;
      height: 100px;
      margin: 1rem auto;
      border-radius: 12px;
      border: 3px solid var(--accent);
      background: #000;
      box-shadow: 0 0 20px rgba(63,183,164,0.7);
    }
    #selectedText {
      margin-bottom: 1rem;
    }
    #modelCanvas {
      width: 220px;
      height: 220px;
      margin: auto;
      background: var(--bg-input);
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(63,183,164,0.5);
    }
    #ideaBtn {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      border: none;
      background: var(--accent);
      color: var(--bg-dark);
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }
    #ideaBtn:hover {
      background: #2a8f81;
    }
    #ideaText {
      margin-top: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-style: italic;
      color: var(--accent-light);
      min-height: 2em;
    }
    #ideaColor {
      width: 16px;
      height: 16px;
      margin-right: 0.5rem;
      border-radius: 4px;
      border: 1px solid var(--accent);
      flex-shrink: 0;
    }

    /* Responsive */
    @media (max-width: 900px) {
      main { grid-template-columns: 1fr; }
      header h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Hoho3D – Buscador Profesional</h1>
    <p>Selecciona, visualiza y crea con tus filamentos</p>
  </header>
  <main>
    <!-- Panel Izquierdo -->
    <div class="panel">
      <h2>Filamentos</h2>
      <input id="searchInput" placeholder="Buscar nombre o #hex…">
      <div id="colorList"></div>
    </div>

    <!-- Panel Central -->
    <div class="panel" id="pickerPanel">
      <h2>Selector de Color</h2>
      <canvas id="colorWheel"></canvas>
      <div id="selectedPreview"></div>
      <div id="selectedText">#5b6770</div>
      <canvas id="modelCanvas"></canvas>
      <button id="ideaBtn">Generar Idea 3D</button>
      <div id="ideaText">
        <span id="ideaColor"></span>
        <span id="ideaDesc">Haz clic para sugerencias…</span>
      </div>
    </div>

    <!-- Panel Derecho -->
    <div class="panel">
      <h2>Colores Cercanos</h2>
      <div id="closestList"></div>
    </div>
  </main>

  <!-- Three.js y GLTFLoader -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r150/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r150/examples/js/loaders/GLTFLoader.js"></script>

  <!-- -------------------------------------------------------------
       JavaScript Modular con Comentarios
  -------------------------------------------------------------- -->
  <script>
  (function() {
    // -----------------------------------------------------------
    // Datos de filamentos
    // -----------------------------------------------------------
    const filaments = [
      { name: "Grilon 3 PLA SILK Platino",   hex: "#5b6770" },
      { name: "Grilon 3 PLA Piel 720",        hex: "#e7b78a" },
      { name: "Grilon 3 PLA Gris Plata",      hex: "#75787b" },
      { name: "Grilon 3 PLA Cobre",           hex: "#a1561c" },
      { name: "Grilon 3 PLA Bronce",          hex: "#998542" }
    ];

    // -----------------------------------------------------------
    // Referencias al DOM
    // -----------------------------------------------------------
    const searchInput = document.getElementById('searchInput');
    const colorList   = document.getElementById('colorList');
    const closestList = document.getElementById('closestList');
    const cw          = document.getElementById('colorWheel');
    const ctxCW       = cw.getContext('2d');
    const selPrev     = document.getElementById('selectedPreview');
    const selText     = document.getElementById('selectedText');
    const modelCanvas = document.getElementById('modelCanvas');
    const ideaBtn     = document.getElementById('ideaBtn');
    const ideaColor   = document.getElementById('ideaColor');
    const ideaDesc    = document.getElementById('ideaDesc');

    // Estado
    let selHex = "#5b6770";

    // -----------------------------------------------------------
    // Funciones utilitarias de color
    // -----------------------------------------------------------
    function hexToRgb(h) {
      return {
        r: parseInt(h.substr(1,2),16),
        g: parseInt(h.substr(3,2),16),
        b: parseInt(h.substr(5,2),16)
      };
    }
    function colorDistance(a,b) {
      const A = hexToRgb(a), B = hexToRgb(b);
      return Math.hypot(A.r - B.r, A.g - B.g, A.b - B.b);
    }

    // -----------------------------------------------------------
    // Renderizado de listas
    // -----------------------------------------------------------
    function renderList(filter, container) {
      container.innerHTML = '';
      filaments
        .filter(f =>
          f.name.toLowerCase().includes(filter.toLowerCase()) ||
          f.hex.includes(filter)
        )
        .forEach(f => {
          const div = document.createElement('div');
          div.className = container===colorList ? 'color-item' : 'closest-item';
          div.innerHTML = `
            <div class="${container===colorList?'color-box':'closest-box'}" style="background:${f.hex}"></div>
            <div class="color-info">
              ${f.name} <span style="color:var(--accent-light)">(${f.hex})</span>
            </div>`;
          div.onclick = () => selectColor(f.hex);
          container.appendChild(div);
        });
    }

    // -----------------------------------------------------------
    // Manejo de selección de color
    // -----------------------------------------------------------
    function selectColor(hex) {
      selHex = hex;
      selPrev.style.background = hex;
      selText.textContent = hex;
      renderClosest();            // Actualizar panel derecho
      updateModelColor(hex);      // Teñir el pajarito 3D
    }

    function renderClosest() {
      renderList('', closestList);
      // Ordenar por distancia
      const items = Array.from(closestList.children);
      items.sort((a,b) => {
        const ha = a.querySelector('div').style.background;
        const hb = b.querySelector('div').style.background;
        return colorDistance(ha, selHex) - colorDistance(hb, selHex);
      });
      closestList.innerHTML = '';
      items.forEach(i => closestList.appendChild(i));
    }

    // -----------------------------------------------------------
    // Buscador dinámico
    // -----------------------------------------------------------
    searchInput.addEventListener('input', () => {
      renderList(searchInput.value, colorList);
    });

    // -----------------------------------------------------------
    // Rueda de color en Canvas
    // -----------------------------------------------------------
    const W = 200, H = 200, R = W/2;
    cw.width = W; cw.height = H;

    function drawColorWheel() {
      const img = ctxCW.createImageData(W,H), d=img.data;
      for(let y=0; y<H; y++){
        for(let x=0; x<W; x++){
          const dx = x-R, dy = y-R, distC = Math.hypot(dx,dy);
          if(distC <= R) {
            let h = Math.atan2(dy,dx)*180/Math.PI;
            if(h<0) h+=360;
            const s = distC/R, v = 1;
            const c = v*s, xh = c*(1 - Math.abs((h/60)%2 -1)), m = v-c;
            let [r1,g1,b1] = [0,0,0];
            if(h<60){r1=c;g1=xh;}
            else if(h<120){r1=xh;g1=c;}
            else if(h<180){g1=c;b1=xh;}
            else if(h<240){g1=xh;b1=c;}
            else if(h<300){r1=xh;b1=c;}
            else{r1=c;b1=xh;}
            const rr = Math.round((r1+m)*255),
                  gg = Math.round((g1+m)*255),
                  bb = Math.round((b1+m)*255),
                  idx = (y*W + x)*4;
            d[idx]=rr; d[idx+1]=gg; d[idx+2]=bb; d[idx+3]=255;
          }
        }
      }
      ctxCW.putImageData(img,0,0);
    }

    function pickColor(evt) {
      const rect = cw.getBoundingClientRect(),
            dx = evt.clientX - rect.left - R,
            dy = evt.clientY - rect.top  - R,
            distC = Math.hypot(dx,dy);
      if(distC>R) return;
      let h = Math.atan2(dy,dx)*180/Math.PI;
      if(h<0) h+=360;
      const s = 1, v = 1;
      const c = v*s, xh = c*(1 - Math.abs((h/60)%2 -1)), m = v-c;
      let [r1,g1,b1] = [0,0,0];
      if(h<60){r1=c;g1=xh;}
      else if(h<120){r1=xh;g1=c;}
      else if(h<180){g1=c;b1=xh;}
      else if(h<240){g1=xh;b1=c;}
      else if(h<300){r1=xh;b1=c;}
      else{r1=c;b1=xh;}
      const rr = Math.round((r1+m)*255),
            gg = Math.round((g1+m)*255),
            bb = Math.round((b1+m)*255),
            hex = "#" + ((1<<24)|(rr<<16)|(gg<<8)|bb).toString(16).slice(1);
      selectColor(hex);
    }

    cw.addEventListener('mousedown', e => { pickColor(e); window.addEventListener('mousemove', pickColor); });
    window.addEventListener('mouseup', _ => window.removeEventListener('mousemove', pickColor));
    drawColorWheel();

    // -----------------------------------------------------------
    // Three.js – Pajarito GLB giratorio
    // -----------------------------------------------------------
    const renderer = new THREE.WebGLRenderer({ canvas: modelCanvas, antialias: true, alpha: true });
    renderer.setSize(220,220);
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45,220/220,0.1,100);
    camera.position.set(0,1.5,3);
    scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));
    let bird;
    new THREE.GLTFLoader().load(
      'https://threejs.org/examples/models/gltf/Parrot.glb',
      gltf => {
        bird = gltf.scene;
        bird.scale.set(0.05,0.05,0.05);
        scene.add(bird);
        updateModelColor(selHex);
      }
    );
    function updateModelColor(hex) {
      if(!bird) return;
      bird.traverse(o => {
        if(o.isMesh) o.material.color.set(hex);
      });
    }
    (function animate() {
      requestAnimationFrame(animate);
      if(bird) bird.rotation.y += 0.01;
      renderer.render(scene, camera);
    })();

    // -----------------------------------------------------------
    // Generador de Ideas con color de stock y display
    // -----------------------------------------------------------
    const ideas = [
      "Imprime un porta lápices con ",
      "Diseña un llavero en ",
      "Crea un soporte para móvil usando ",
      "Haz un organizador elegante en ",
      "Construye una caja minimalista con "
    ];
    ideaBtn.onclick = () => {
      const fil = filaments[Math.floor(Math.random()*filaments.length)];
      ideaColor.style.background = fil.hex;
      ideaDesc.textContent = ideas[Math.floor(Math.random()*ideas.length)] + fil.hex;
    };

    // -----------------------------------------------------------
    // Inicialización
    // -----------------------------------------------------------
    renderList('', colorList);
    selectColor(selHex);

  })();
  </script>
</body>
</html>


